<!-- HTML header for doxygen 1.15.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
    <head>
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=11" />
        <meta name="generator" content="Doxygen 1.14.0" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>C++ Utilities: Formatter Specialisation</title>
        <link href="tabs.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="jquery.js"></script>
        <script type="text/javascript" src="dynsections.js"></script>
        <script type="text/javascript" src="clipboard.js"></script>
        <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
 <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
        <!-- ... other metadata & script includes ... -->
        <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
        <script type="text/javascript">
            DoxygenAwesomeDarkModeToggle.init()
        </script>
    </head>
    <body>
            <div id="top">
                <!-- do not remove this div, it is closed by doxygen! -->
                <div id="titlearea">
                    <table cellspacing="0" cellpadding="0">
                        <tbody>
                            <tr id="projectrow">
                                <td id="projectalign">
                                    <div id="projectname">
                                        C++ Utilities
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- end header part -->
            </div>
        </div>
    </body>
</html>
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_docs_2pages_2Logging.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Formatter Specialisation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="formatter-specialisation-1"></a></p>
<p>The <span class="tt">&lt;<a class="el" href="formatter_8h.html" title="Specialises std::formatter for types that have an accessible to_string() method.   See the Formatter ...">utilities/formatter.h</a>&gt;</span> header speci# Logging Utilities</p>
<p>The header <span class="tt">&lt;<a class="el" href="log_8h.html" title="Some very simple facilities to create and handle log &amp; debug messages.   See the Logging page for all...">utilities/log.h</a>&gt;</span> provides a couple of macros for simple logging and debugging.</p>
<ul>
<li><span class="tt"><a class="el" href="log_8h.html#a3577749fb48d57a158b8ac1a0b3ab57e" title="Create and dispatch a log message. Can be turned off by setting NO_LOGS at compile time.">LOG(...)</a></span> dispatches messages <b>unless</b> the <span class="tt">NO_LOGS</span> flag is set at compile time.</li>
<li><span class="tt"><a class="el" href="log_8h.html#ae8924623ca601364965e3d88fb7f40fa" title="Create and dispatch a debug messages â€“ only ever printed if the DEBUG flag is set at compile time.">DBG(...)</a></span> dispatches a message <b>only if</b> the <span class="tt">DEBUG</span> flag is set at compile time.</li>
</ul>
<p>These macros create and dispatch <span class="tt"><a class="el" href="classutilities_1_1message.html" title="A utilities::message object captures a location where the message was created and optionally a payloa...">utilities::message</a></span> objects, which hold an arbitrary user-supplied message. The instances also include source code location information. The <span class="tt">LOG</span> and <span class="tt">DBG</span> macros automatically pass the correct source code location information to the message.</p>
<p>The message payload can be anything that works for the facilities in <a href="https://en.cppreference.com/w/cpp/utility/format/format"><span class="tt">std::format</span></a>. The default message handler prints the source code location if there is no payload.</p>
<dl class="section warning"><dt>Warning</dt><dd>Microsoft's old traditional preprocessor is unhappy with some of our macros, but its newer, cross-platform-compatible one is fine. <br  />
 Add the <span class="tt">/Zc:preprocessor</span> flag to use that upgrade at compile time. Our <span class="tt">CMake</span> module <span class="tt">compiler_init</span> does that automatically for you.</dd></dl>
<h1 class="doxsection"><a class="anchor" id="message-handling"></a>
Message Handling</h1>
<p>The macros create and dispatch messages to a message handler immediately. The default handler prints the message and the location information to a default standard output stream. You can change that default stream, for example:</p>
<div class="fragment"><div class="line">log_file = std::ofstream(<span class="stringliteral">&quot;log.txt&quot;</span>);</div>
<div class="line"><a class="code hl_variable" href="classutilities_1_1message.html#aea8dd7c72fc58b84063a91c180cae5f0">utilities::message::stream</a> = &amp;log_file;</div>
<div class="ttc" id="aclassutilities_1_1message_html_aea8dd7c72fc58b84063a91c180cae5f0"><div class="ttname"><a href="classutilities_1_1message.html#aea8dd7c72fc58b84063a91c180cae5f0">utilities::message::stream</a></div><div class="ttdeci">static std::ostream * stream</div><div class="ttdoc">The stream used by the default message handler.</div><div class="ttdef"><b>Definition</b> log.h:54</div></div>
</div><!-- fragment --><p>For fancier usage, you can interpose your message handler.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> my_handler(<span class="keyword">const</span> <a class="code hl_class" href="classutilities_1_1message.html">utilities::message</a>&amp; msg) { ... }</div>
<div class="line"><a class="code hl_function" href="classutilities_1_1message.html#ae06e53f22653fbf3efa4096b04858daa">utilities::message::handler</a>() = my_handler;</div>
<div class="ttc" id="aclassutilities_1_1message_html"><div class="ttname"><a href="classutilities_1_1message.html">utilities::message</a></div><div class="ttdoc">A utilities::message object captures a location where the message was created and optionally a payloa...</div><div class="ttdef"><b>Definition</b> log.h:36</div></div>
<div class="ttc" id="aclassutilities_1_1message_html_ae06e53f22653fbf3efa4096b04858daa"><div class="ttname"><a href="classutilities_1_1message.html#ae06e53f22653fbf3efa4096b04858daa">utilities::message::handler</a></div><div class="ttdeci">static handler_type *&amp; handler()</div><div class="ttdoc">Class method that lets you set a custom message handling function.</div><div class="ttdef"><b>Definition</b> log.h:44</div></div>
</div><!-- fragment --><p>Your handler can do whatever it likes with the messages it receives. You can revert to the default handler by calling the class method <span class="tt"><a class="el" href="classutilities_1_1message.html#aaeea3d6722bfa7b0949e3d333ae321b0" title="Class method that sets the message handler back to the default value.">utilities::message::use_default_handler()</a></span>.</p>
<dl class="section note"><dt>Note</dt><dd>Everything here is deliberately rudimentary, with no consideration for rotating log files, etc., or for streaming efficiency. The primary use case for the macros above and the underlying <span class="tt"><a class="el" href="classutilities_1_1message.html" title="A utilities::message object captures a location where the message was created and optionally a payloa...">utilities::message</a></span> class is easily printing useful messages during the development cycle. The emphasis is on ease of use rather than great generality or speed. During the development cycle, the typical output is going to be small anyway.</dd></dl>
<h1 class="doxsection"><a class="anchor" id="example-44"></a>
Example</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="log_8h.html">utilities/log.h</a>&gt;</span></div>
<div class="line"><span class="keywordtype">int</span> add(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="log_8h.html#ae8924623ca601364965e3d88fb7f40fa">DBG</a>(<span class="stringliteral">&quot;The DEBUG flag was set at compile time.&quot;</span>);</div>
<div class="line">    <a class="code hl_define" href="log_8h.html#a3577749fb48d57a158b8ac1a0b3ab57e">LOG</a>(<span class="stringliteral">&quot;x = {}, y = {}&quot;</span>, x, y);</div>
<div class="line">    <span class="keywordflow">return</span> x + y;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="log_8h.html#a3577749fb48d57a158b8ac1a0b3ab57e">LOG</a>(); <span class="comment">// &lt;1&gt;</span></div>
<div class="line">    <span class="keywordflow">return</span> add(10, 11);</div>
<div class="line">}</div>
<div class="ttc" id="alog_8h_html"><div class="ttname"><a href="log_8h.html">log.h</a></div><div class="ttdoc">Some very simple facilities to create and handle log &amp; debug messages.   See the Logging page for all...</div></div>
<div class="ttc" id="alog_8h_html_a3577749fb48d57a158b8ac1a0b3ab57e"><div class="ttname"><a href="log_8h.html#a3577749fb48d57a158b8ac1a0b3ab57e">LOG</a></div><div class="ttdeci">#define LOG(...)</div><div class="ttdoc">Create and dispatch a log message. Can be turned off by setting NO_LOGS at compile time.</div><div class="ttdef"><b>Definition</b> log.h:22</div></div>
<div class="ttc" id="alog_8h_html_ae8924623ca601364965e3d88fb7f40fa"><div class="ttname"><a href="log_8h.html#ae8924623ca601364965e3d88fb7f40fa">DBG</a></div><div class="ttdeci">#define DBG(...)</div><div class="ttdoc">Create and dispatch a debug messages â€“ only ever printed if the DEBUG flag is set at compile time.</div><div class="ttdef"><b>Definition</b> log.h:17</div></div>
</div><!-- fragment --><ol type="1">
<li>A call to <span class="tt">LOG</span> without any message will print the source location.</li>
</ol>
<p>If that source was in a file called <span class="tt">example.cpp</span>, then the program will output:</p>
<div class="fragment"><div class="line">[LOG] function &#39;main&#39; (example.cpp, line 11)</div>
<div class="line">[DBG] function &#39;add&#39; (example.cpp, line 4): The DEBUG flag was set at compile time.</div>
<div class="line">[LOG] function &#39;add&#39; (example.cpp, line 5): x = 10, y = 11</div>
</div><!-- fragment --><p>alises <a href="https://en.cppreference.com/w/cpp/utility/format/formatter"><span class="tt">std::formatter</span></a> for <em>any</em> type that has a <span class="tt">to_string()</span> method.</p>
<p>C++20 introduced <a href="https://en.cppreference.com/w/cpp/utility/format/format"><span class="tt">std::format</span></a> to create strings with interpolated values; a core feature for the <a href="https://en.cppreference.com/w/cpp/io/print.html"><span class="tt">std::print</span></a> standard output library.</p>
<p>Moreover, you can extend the standard library for your own types by <em>specialising</em> the <a href="https://en.cppreference.com/w/cpp/utility/format/formatter"><span class="tt">std::formatter</span></a> class.</p>
<p>Many classes already implement a <span class="tt">to_string()</span> method that returns a string representation of an instance. It seems like a good stopgap measure to connect all those types to <span class="tt">std::format</span> and its friends.</p>
<p>We have a <a href="https://en.cppreference.com/w/cpp/language/constraints"><span class="tt">concept</span></a> that captures types with an accessible <span class="tt">to_string(...)</span> method that can be called without any arguments (of course, there can be lots of default arguments for the function):</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">concept </span><a class="code hl_concept" href="conceptutilities_1_1has__to__string.html">utilities::has_to_string</a> = <span class="keyword">requires</span>(<span class="keyword">const</span> T&amp; x) {</div>
<div class="line">    { x.to_string() } -&gt; std::convertible_to&lt;std::string&gt;;</div>
<div class="line">};</div>
<div class="ttc" id="aconceptutilities_1_1has__to__string_html"><div class="ttname"><a href="conceptutilities_1_1has__to__string.html">utilities::has_to_string</a></div><div class="ttdoc">A concept that matches any type that has an accessible std::string to_string() const method.</div><div class="ttdef"><b>Definition</b> formatter.h:18</div></div>
</div><!-- fragment --><p>We then specialised <a href="https://en.cppreference.com/w/cpp/utility/format/formatter"><span class="tt">std::formatter</span></a> to work with <em>any</em> <span class="tt">has_to_string</span> compatible class.</p>
<h1 class="doxsection"><a class="anchor" id="example-45"></a>
Example</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="formatter_8h.html">utilities/formatter.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;print&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Whatever {</div>
<div class="line">    std::string to_string()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;Whatever!&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    Whatever w;</div>
<div class="line">    std::println(<span class="stringliteral">&quot;Struct with a `to_string()` method: &#39;{}&#39;&quot;</span>, w);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aformatter_8h_html"><div class="ttname"><a href="formatter_8h.html">formatter.h</a></div><div class="ttdoc">Specialises std::formatter for types that have an accessible to_string() method.   See the Formatter ...</div></div>
</div><!-- fragment --><p>Running that outputs:</p>
<div class="fragment"><div class="line">Struct with a to_string() method: &#39;Whatever!&#39;</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="notes-1"></a>
Notes</h1>
<ol type="1">
<li>The <span class="tt">std::formatter</span> specialisation only works with <em>default</em> formatting. So <span class="tt">std::println("{}", w)</span> is fine, but something like <span class="tt">std::println("{:x}", w)</span> will cause a program fault. <br  />
 Your <span class="tt">to_string</span> method may handle various output options, but we only ever call it with no passed arguments.</li>
<li>You can safely have a <span class="tt">to_string(...)</span> method <b>and</b> provide your own specialisation of <span class="tt">std::formatter</span>. <br  />
 The compiler will see your specialisation as a better fit than the blanket one provided in <span class="tt">&lt;<a class="el" href="formatter_8h.html" title="Specialises std::formatter for types that have an accessible to_string() method.   See the Formatter ...">utilities/formatter.h</a>&gt;</span>.</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="see-also-2"></a>
See Also</h1>
<p><a href="https://en.cppreference.com/w/cpp/utility/format/format"><span class="tt">std::format</span></a> <br  />
 <a href="https://en.cppreference.com/w/cpp/utility/format/formatter"><span class="tt">std::formatter</span></a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
